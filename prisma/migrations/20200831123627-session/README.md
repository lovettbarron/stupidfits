# Migration `20200831123627-session`

This migration has been generated by Andrew Lovett-Barron at 8/31/2020, 2:36:27 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Post" DROP CONSTRAINT "Post_authorId_fkey"

ALTER TABLE "public"."Post" ALTER COLUMN "authorId" SET DATA TYPE text 

ALTER TABLE "public"."User" DROP CONSTRAINT "User_pkey",
ADD COLUMN "emailVerified" timestamp(3)   ,
ADD COLUMN "image" text   ,
ADD COLUMN "createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
ADD COLUMN "updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
ALTER COLUMN "email" DROP NOT NULL,
ALTER COLUMN "id" SET DATA TYPE text ,
ALTER COLUMN "id" DROP DEFAULT,
ALTER COLUMN "id" DROP DEFAULT,
ADD PRIMARY KEY ("id");
DROP SEQUENCE "User_id_seq"

CREATE TABLE "public"."Session" (
"id" text   NOT NULL ,
"userId" text   NOT NULL ,
"accessToken" text   NOT NULL ,
"sessionToken" text   NOT NULL ,
"accessTokenExpires" timestamp(3)   ,
"expires" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."Account" (
"id" text   NOT NULL ,
"compoundId" text   NOT NULL ,
"userId" text   NOT NULL ,
"providerId" text   NOT NULL ,
"providerType" text   NOT NULL ,
"providerAccountId" text   NOT NULL ,
"refreshToken" text   ,
"accessToken" text   ,
"accessTokenExpires" timestamp(3)   ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."VerificationRequest" (
"id" text   NOT NULL ,
"identifier" text   NOT NULL ,
"token" text   NOT NULL ,
"expires" timestamp(3)   NOT NULL ,
"createdAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updatedAt" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE UNIQUE INDEX "Session.accessToken_unique" ON "public"."Session"("accessToken")

CREATE UNIQUE INDEX "Session.sessionToken_unique" ON "public"."Session"("sessionToken")

CREATE UNIQUE INDEX "Account.compoundId_unique" ON "public"."Account"("compoundId")

CREATE UNIQUE INDEX "Account.providerAccountId_unique" ON "public"."Account"("providerAccountId")

CREATE UNIQUE INDEX "VerificationRequest.token_unique" ON "public"."VerificationRequest"("token")

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Account" ADD FOREIGN KEY ("userId")REFERENCES "public"."User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Post" ADD FOREIGN KEY ("authorId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200830215917-init..20200831123627-session
--- datamodel.dml
+++ datamodel.dml
@@ -3,23 +3,65 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model User {
-  email  String  @unique
-  id     Int     @default(autoincrement()) @id
-  name   String?
-  social String  @unique
-  posts  Post[]
+  id            String    @default(uuid()) @id
+  email         String?   @unique
+  name          String?
+  social        String    @unique
+  posts         Post[]
+  emailVerified DateTime?
+  image         String?
+  sessions      Session[]
+  accounts      Account[]
+  createdAt     DateTime  @default(now())
+  updatedAt     DateTime  @updatedAt @default(now())
 }
+model Session {
+  id                 String    @default(uuid()) @id
+  userId             String
+  user               User      @relation(fields: [userId], references: [id])
+  accessToken        String    @default(cuid()) @unique
+  sessionToken       String    @default(cuid()) @unique
+  accessTokenExpires DateTime?
+  expires            DateTime?
+  createdAt          DateTime  @default(now())
+  updatedAt          DateTime  @updatedAt @default(now())
+}
+
+model Account {
+  id                 String    @default(uuid()) @id
+  compoundId         String    @unique
+  userId             String
+  user               User      @relation(fields: [userId], references: [id])
+  providerId         String
+  providerType       String
+  providerAccountId  String    @unique
+  refreshToken       String?
+  accessToken        String?
+  accessTokenExpires DateTime?
+  createdAt          DateTime  @default(now())
+  updatedAt          DateTime  @updatedAt @default(now())
+}
+
+model VerificationRequest {
+  id         String   @default(uuid()) @id
+  identifier String
+  token      String   @unique
+  expires    DateTime
+  createdAt  DateTime @default(now())
+  updatedAt  DateTime @updatedAt @default(now())
+}
+
 model Post {
   id        Int     @default(autoincrement()) @id
   author    User?   @relation(fields: [authorId], references: [id])
-  authorId  Int?
+  authorId  String?
   content   String?
   published Boolean @default(false)
   title     String?
   social    Social
```


