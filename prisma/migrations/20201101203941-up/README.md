# Migration `20201101203941-up`

This migration has been generated by Andrew Lovett-Barron at 11/1/2020, 9:39:41 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Media" DROP COLUMN "svg"

CREATE TABLE "public"."ItemLayer" (
"id" SERIAL,
"mediaId" integer   ,
"itemId" integer   ,
"x" Decimal(65,30)   NOT NULL ,
"y" Decimal(65,30)   NOT NULL ,
"r" Decimal(65,30)   NOT NULL ,
PRIMARY KEY ("id")
)

ALTER TABLE "public"."ItemLayer" ADD FOREIGN KEY ("mediaId")REFERENCES "public"."Media"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "public"."ItemLayer" ADD FOREIGN KEY ("itemId")REFERENCES "public"."Item"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201101181745-up..20201101203941-up
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Account {
   id                 Int       @id @default(autoincrement())
@@ -69,8 +69,9 @@
   Comment Comment[]
   Media   Media[]   @relation("UserMediaRelationship")
+
   @@map(name: "users")
 }
 model VerificationRequest {
@@ -84,24 +85,24 @@
   @@map(name: "verification_requests")
 }
 model Media {
-  id          Int      @id @default(autoincrement())
-  createdAt   DateTime @default(now()) @map(name: "created_at")
-  updatedAt   DateTime @default(now()) @map(name: "updated_at")
-  insta_id    String?  @unique
+  id          Int         @id @default(autoincrement())
+  createdAt   DateTime    @default(now()) @map(name: "created_at")
+  updatedAt   DateTime    @default(now()) @map(name: "updated_at")
+  insta_id    String?     @unique
   username    String?
   timestamp   Int
   image       String?
-  cloudinary  String   @default("")
+  cloudinary  String      @default("")
   export      String?
   censor      String?
   url         String?
-  svg         String?
+  layers      ItemLayer[] @relation("MediaLayer")
   description String
-  fit         Fit?     @relation("MediaRelationship", fields: [fitId], references: [id])
+  fit         Fit?        @relation("MediaRelationship", fields: [fitId], references: [id])
   fitId       Int?
-  user        User?    @relation("UserMediaRelationship", fields: [userId], references: [id])
+  user        User?       @relation("UserMediaRelationship", fields: [userId], references: [id])
   userId      Int?
 }
 model Fit {
@@ -137,29 +138,30 @@
   style Style[]
 }
 model Item {
-  id        Int      @id @default(autoincrement())
-  createdAt DateTime @default(now()) @map(name: "created_at")
-  updatedAt DateTime @default(now()) @map(name: "updated_at")
+  id        Int         @id @default(autoincrement())
+  createdAt DateTime    @default(now()) @map(name: "created_at")
+  updatedAt DateTime    @default(now()) @map(name: "updated_at")
   type      ItemType
   photo     String?
-  brand     Brand    @relation(fields: [brandId], references: [id])
+  brand     Brand       @relation(fields: [brandId], references: [id])
   model     String
   year      Int?
   size      String?
   colour    Colour[]
   sale      String?
   archive   Boolean?
   repair    Boolean?
-  closet    Closet[] @relation("ClosetContent", fields: [closetId], references: [id])
+  closet    Closet[]    @relation("ClosetContent", fields: [closetId], references: [id])
   closetId  Int?
-  fit       Fit[]    @relation("FitComponent", fields: [fitId], references: [id])
+  fit       Fit[]       @relation("FitComponent", fields: [fitId], references: [id])
   fitId     Int?
-  user      User?    @relation("ItemRelation", fields: [userId], references: [id])
+  user      User?       @relation("ItemRelation", fields: [userId], references: [id])
   userId    Int?
-  Closet    Closet?  @relation("ClosetGrails", fields: [closetId], references: [id])
+  Closet    Closet?     @relation("ClosetGrails", fields: [closetId], references: [id])
   brandId   Int
+  layers    ItemLayer[] @relation("ItemItemLayer")
 }
 model Comment {
   id        Int      @id @default(autoincrement())
@@ -182,8 +184,20 @@
   fit         Fit[]    @relation(fields: [fitId], references: [id])
   fitId       Int?
 }
+model ItemLayer {
+  id      Int    @id @default(autoincrement())
+  media   Media? @relation("MediaLayer", fields: [mediaId], references: [id])
+  mediaId Int?
+  item    Item?  @relation("ItemItemLayer", fields: [itemId], references: [id])
+  itemId  Int?
+  x       Float
+  y       Float
+  r       Float
+
+}
+
 enum ItemType {
   BAG
   SHOE
   JACKET
```


