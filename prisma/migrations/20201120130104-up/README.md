# Migration `20201120130104-up`

This migration has been generated by Andrew Lovett-Barron at 11/20/2020, 2:01:04 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Style" DROP CONSTRAINT "Style_collectionId_fkey"

ALTER TABLE "public"."Style" DROP CONSTRAINT "Style_reviewId_fkey"

ALTER TABLE "public"."Style" DROP CONSTRAINT "Style_userId_fkey"

ALTER TABLE "public"."Comment" ADD COLUMN "battleId" integer   

ALTER TABLE "public"."Style" DROP COLUMN "userId",
DROP COLUMN "reviewId",
DROP COLUMN "collectionId"

CREATE TABLE "public"."Battle" (
"id" SERIAL,
"startDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"endDate" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"rules" text   NOT NULL ,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" integer   NOT NULL ,
"collectionId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BattleRound" (
"id" SERIAL,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BattleMatchup" (
"id" SERIAL,
"battleId" integer   NOT NULL ,
"battleRoundId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."BattleVote" (
"id" SERIAL,
"created_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"updated_at" timestamp(3)   NOT NULL DEFAULT CURRENT_TIMESTAMP,
"userId" integer   NOT NULL ,
"battleMatchupId" integer   NOT NULL ,
"fitId" integer   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."_StyleToUser" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_BattleMatchupToFit" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_ReviewToStyle" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_CollectionToStyle" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE TABLE "public"."_BattleToStyle" (
"A" integer   NOT NULL ,
"B" integer   NOT NULL 
)

CREATE UNIQUE INDEX "_StyleToUser_AB_unique" ON "public"."_StyleToUser"("A", "B")

CREATE INDEX "_StyleToUser_B_index" ON "public"."_StyleToUser"("B")

CREATE UNIQUE INDEX "_BattleMatchupToFit_AB_unique" ON "public"."_BattleMatchupToFit"("A", "B")

CREATE INDEX "_BattleMatchupToFit_B_index" ON "public"."_BattleMatchupToFit"("B")

CREATE UNIQUE INDEX "_ReviewToStyle_AB_unique" ON "public"."_ReviewToStyle"("A", "B")

CREATE INDEX "_ReviewToStyle_B_index" ON "public"."_ReviewToStyle"("B")

CREATE UNIQUE INDEX "_CollectionToStyle_AB_unique" ON "public"."_CollectionToStyle"("A", "B")

CREATE INDEX "_CollectionToStyle_B_index" ON "public"."_CollectionToStyle"("B")

CREATE UNIQUE INDEX "_BattleToStyle_AB_unique" ON "public"."_BattleToStyle"("A", "B")

CREATE INDEX "_BattleToStyle_B_index" ON "public"."_BattleToStyle"("B")

ALTER TABLE "public"."Battle" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Battle" ADD FOREIGN KEY ("collectionId")REFERENCES "public"."Collection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BattleMatchup" ADD FOREIGN KEY ("battleId")REFERENCES "public"."Battle"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BattleMatchup" ADD FOREIGN KEY ("battleRoundId")REFERENCES "public"."BattleRound"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BattleVote" ADD FOREIGN KEY ("userId")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BattleVote" ADD FOREIGN KEY ("battleMatchupId")REFERENCES "public"."BattleMatchup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."BattleVote" ADD FOREIGN KEY ("fitId")REFERENCES "public"."Fit"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_StyleToUser" ADD FOREIGN KEY ("A")REFERENCES "public"."Style"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_StyleToUser" ADD FOREIGN KEY ("B")REFERENCES "public"."users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BattleMatchupToFit" ADD FOREIGN KEY ("A")REFERENCES "public"."BattleMatchup"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BattleMatchupToFit" ADD FOREIGN KEY ("B")REFERENCES "public"."Fit"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ReviewToStyle" ADD FOREIGN KEY ("A")REFERENCES "public"."Review"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_ReviewToStyle" ADD FOREIGN KEY ("B")REFERENCES "public"."Style"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CollectionToStyle" ADD FOREIGN KEY ("A")REFERENCES "public"."Collection"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_CollectionToStyle" ADD FOREIGN KEY ("B")REFERENCES "public"."Style"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BattleToStyle" ADD FOREIGN KEY ("A")REFERENCES "public"."Battle"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."_BattleToStyle" ADD FOREIGN KEY ("B")REFERENCES "public"."Style"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."Comment" ADD FOREIGN KEY ("battleId")REFERENCES "public"."Battle"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201119220813-up..20201120130104-up
--- datamodel.dml
+++ datamodel.dml
@@ -4,9 +4,9 @@
 }
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 model Account {
   id                 Int       @id @default(autoincrement())
@@ -75,8 +75,10 @@
   Review       Review[]
   Collection   Collection[]
   Notification Notification[]
+  Battle       Battle[]
+  BattleVote   BattleVote[]
   @@map(name: "users")
 }
 model VerificationRequest {
@@ -112,22 +114,23 @@
   reviewId    Int?
 }
 model Fit {
-  id         Int          @id @default(autoincrement())
-  createdAt  DateTime     @default(now()) @map(name: "created_at")
-  updatedAt  DateTime     @default(now()) @map(name: "updated_at")
-  media      Media[]      @relation("MediaRelationship")
-  components Item[]       @relation("FitComponent")
-  desc       String?
-  temp       String?
-  user       User?        @relation("FitRelation", fields: [userId], references: [id])
-  userId     Int?
-  status     Status       @default(value: PENDING)
-  Comment    Comment[]
-  style      Style[]
-  Collection Collection[]
-
+  id            Int             @id @default(autoincrement())
+  createdAt     DateTime        @default(now()) @map(name: "created_at")
+  updatedAt     DateTime        @default(now()) @map(name: "updated_at")
+  media         Media[]         @relation("MediaRelationship")
+  components    Item[]          @relation("FitComponent")
+  desc          String?
+  temp          String?
+  user          User?           @relation("FitRelation", fields: [userId], references: [id])
+  userId        Int?
+  status        Status          @default(value: PENDING)
+  Comment       Comment[]
+  style         Style[]
+  Collection    Collection[]
+  BattleMatchup BattleMatchup[]
+  BattleVote    BattleVote[]
 }
 model Closet {
   id     Int    @id @default(autoincrement())
@@ -186,26 +189,26 @@
   Review       Review?     @relation(fields: [reviewId], references: [id])
   reviewId     Int?
   Collection   Collection? @relation(fields: [collectionId], references: [id])
   collectionId Int?
+  Battle       Battle?     @relation(fields: [battleId], references: [id])
+  battleId     Int?
 }
 model Style {
-  id           Int         @id @default(autoincrement())
-  name         String
-  description  String
-  brand        Brand[]     @relation(fields: [brandId], references: [id])
-  brandId      Int?
-  createdAt    DateTime    @default(now()) @map(name: "created_at")
-  updatedAt    DateTime    @default(now()) @map(name: "updated_at")
-  fit          Fit[]       @relation(fields: [fitId], references: [id])
-  fitId        Int?
-  User         User?       @relation(fields: [userId], references: [id])
-  userId       Int?
-  Review       Review?     @relation(fields: [reviewId], references: [id])
-  reviewId     Int?
-  Collection   Collection? @relation(fields: [collectionId], references: [id])
-  collectionId Int?
+  id          Int          @id @default(autoincrement())
+  name        String
+  description String
+  brand       Brand[]      @relation(fields: [brandId], references: [id])
+  brandId     Int?
+  createdAt   DateTime     @default(now()) @map(name: "created_at")
+  updatedAt   DateTime     @default(now()) @map(name: "updated_at")
+  fit         Fit[]        @relation(fields: [fitId], references: [id])
+  fitId       Int?
+  User        User[]
+  Review      Review[]
+  Collection  Collection[]
+  Battle      Battle[]
 }
 model ItemLayer {
   id      Int    @id @default(autoincrement())
@@ -251,8 +254,9 @@
   createdAt   DateTime  @default(now()) @map(name: "created_at")
   updatedAt   DateTime  @default(now()) @map(name: "updated_at")
   tags        Style[]
   Comment     Comment[]
+  Battle      Battle[]
 }
 model Notification {
   id        Int      @id @default(autoincrement())
@@ -265,8 +269,57 @@
   userId Int
 }
+model Battle {
+  id        Int      @id @default(autoincrement())
+  startDate DateTime @default(now())
+  endDate   DateTime @default(now())
+  rules     String
+
+
+  user          User            @relation(fields: [userId], references: [id])
+  collection    Collection      @relation(fields: [collectionId], references: [id])
+  tags          Style[]
+  Comment       Comment[]
+  createdAt     DateTime        @default(now()) @map(name: "created_at")
+  updatedAt     DateTime        @default(now()) @map(name: "updated_at")
+  BattleMatchup BattleMatchup[]
+  userId        Int
+  collectionId  Int
+}
+
+model BattleRound {
+  id        Int             @id @default(autoincrement())
+  matchups  BattleMatchup[]
+  createdAt DateTime        @default(now()) @map(name: "created_at")
+  updatedAt DateTime        @default(now()) @map(name: "updated_at")
+
+}
+
+model BattleMatchup {
+  id            Int          @id @default(autoincrement())
+  battle        Battle       @relation(fields: [battleId], references: [id])
+  round         BattleRound  @relation(fields: [battleRoundId], references: [id])
+  Fits          Fit[]
+  votes         BattleVote[]
+  battleId      Int
+  battleRoundId Int
+}
+
+model BattleVote {
+  id        Int           @id @default(autoincrement())
+  user      User          @relation(fields: [userId], references: [id])
+  matchup   BattleMatchup @relation(fields: [battleMatchupId], references: [id])
+  fit       Fit           @relation(fields: [fitId], references: [id])
+  createdAt DateTime      @default(now()) @map(name: "created_at")
+  updatedAt DateTime      @default(now()) @map(name: "updated_at")
+
+  userId          Int
+  battleMatchupId Int
+  fitId           Int
+}
+
 enum ReviewFocus {
   ITEM
   STYLE
   FIT
```


