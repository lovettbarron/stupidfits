# Migration `20201128215324-up`

This migration has been generated by Andrew Lovett-Barron at 11/28/2020, 10:53:24 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
CREATE TABLE "Invite" (
    "id" TEXT NOT NULL,
    "email" TEXT,
    "collectionId" INTEGER,
    "groupId" TEXT,

    PRIMARY KEY ("id")
)

CREATE TABLE "_memberGroup" (
    "A" TEXT NOT NULL,
    "B" INTEGER NOT NULL
)

DROP TABLE "Group"

CREATE UNIQUE INDEX "_memberGroup_AB_unique" ON "_memberGroup"("A", "B")

CREATE INDEX "_memberGroup_B_index" ON "_memberGroup"("B")

ALTER TABLE "Invite" ADD FOREIGN KEY("collectionId")REFERENCES "Collection"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "Invite" ADD FOREIGN KEY("groupId")REFERENCES "groups"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "_memberGroup" ADD FOREIGN KEY("A")REFERENCES "groups"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "_memberGroup" ADD FOREIGN KEY("B")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "Collection" ADD FOREIGN KEY("groupId")REFERENCES "groups"("id") ON DELETE SET NULL ON UPDATE CASCADE

ALTER TABLE "groups" ADD FOREIGN KEY("userId")REFERENCES "users"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201127144924-up..20201128215324-up
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -9,9 +9,9 @@
 }
 // datasource db {
 //   provider = "postgresql"
-//   url = "***"
+//   url = "***"
 // }
 model Account {
   id                 Int       @id @default(autoincrement())
@@ -74,11 +74,12 @@
   top              Int[]
   bottom           Int[]
   tags             Style[]
-  Comment Comment[]
-  Media   Media[]   @relation("UserMediaRelationship")
-
+  Comment      Comment[]
+  Media        Media[]        @relation("UserMediaRelationship")
+  GroupAdmin   Group[]        @relation("adminGroup")
+  Group        Group[]        @relation("memberGroup")
   Review       Review[]
   Collection   Collection[]
   Notification Notification[]
   Battle       Battle[]
@@ -185,22 +186,21 @@
   reviewId  Int?
 }
 model Comment {
-  id           Int         @id @default(autoincrement())
-  createdAt    DateTime    @default(now()) @map(name: "created_at")
-  updatedAt    DateTime    @default(now()) @map(name: "updated_at")
-  user         User        @relation(fields: [userId], references: [id])
-  fit          Fit?        @relation(fields: [fitId], references: [id])
-  userId       Int
-  fitId        Int?
-  comment      String
-  Review       Review?     @relation(fields: [reviewId], references: [id])
-  reviewId     Int?
-  Collection   Collection? @relation(fields: [collectionId], references: [id])
-  collectionId Int?
-  Battle       Battle?     @relation(fields: [battleId], references: [id])
-  battleId     Int?
+  id        Int      @id @default(autoincrement())
+  createdAt DateTime @default(now()) @map(name: "created_at")
+  updatedAt DateTime @default(now()) @map(name: "updated_at")
+  user      User     @relation(fields: [userId], references: [id])
+  fit       Fit?     @relation(fields: [fitId], references: [id])
+  userId    Int
+  fitId     Int?
+  comment   String
+  Review    Review?  @relation(fields: [reviewId], references: [id])
+  reviewId  Int?
+
+  Battle   Battle? @relation(fields: [battleId], references: [id])
+  battleId Int?
 }
 model Style {
   id          Int          @id @default(autoincrement())
@@ -248,8 +248,36 @@
   userId Int
 }
+model Group {
+  id          String   @id @default(uuid())
+  name        String
+  user        User     @relation("adminGroup", fields: [userId], references: [id])
+  links       String[]
+  slug        String
+  description String
+  inviteonly  Boolean  @default(true)
+  public      Boolean  @default(false)
+
+
+  member     User[]       @relation("memberGroup")
+  collection Collection[]
+  Invite     Invite[]     @relation("inviteGroup")
+
+  userId Int
+  @@map(name: "groups")
+}
+
+model Invite {
+  id           String      @id @default(uuid())
+  email        String?
+  collection   Collection? @relation("inviteCollection", fields: [collectionId], references: [id])
+  group        Group?      @relation("inviteGroup", fields: [groupId], references: [id])
+  collectionId Int?
+  groupId      String?
+}
+
 model Collection {
   id          Int     @id @default(autoincrement())
   user        User    @relation(fields: [userId], references: [id])
   userId      Int
@@ -260,13 +288,15 @@
   public      Boolean @default(false)
   published   Boolean @default(false)
   oneperuser  Boolean @default(false)
-  createdAt DateTime  @default(now()) @map(name: "created_at")
-  updatedAt DateTime  @default(now()) @map(name: "updated_at")
+  group     Group?   @relation(fields: [groupId], references: [id])
+  createdAt DateTime @default(now()) @map(name: "created_at")
+  updatedAt DateTime @default(now()) @map(name: "updated_at")
   tags      Style[]
-  Comment   Comment[]
   Battle    Battle[]
+  Invite    Invite[] @relation("inviteCollection")
+  groupId   String?
 }
 model Notification {
   id        Int      @id @default(autoincrement())
```


